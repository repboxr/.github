# Repbox

Author: Sebastian Kranz, Ulm University

The `repboxr` organisation mainly contains R packages for the *Repbox* project that shall facilitate reproducible research. (Unfornately `repbox` was already taken as an organisation name on Github. Since most of the code is in R, I picked `repboxr`, instead.) The project currently concentrates on economics and social sciences.

The main goals are:
  - Help data editors and authors to check code & data supplements
  - Create a systematic data base for meta studies containing mapped information from run supplements and articles. A focus will be on regression analyses. 

## Far from being generally usable

Currently, all packages are in a pilot phase and the project needs substantial large scale testing, improvement and documentation. It will take substantial effort before it can be used for researchers to run their meta studies and there can be a lot of breaking changes. While currently almost all contributions are by Sebastian Kranz, the goals is that a stable version will have a wide community including data editors, authors and researchers performing meta studies.

## Overview of packages and repositories

[repboxRun](https://github.com/repboxr/repboxRun): Functions that help running repbox analysis steps that are implemented in the different packages.

[repboxArt](https://github.com/repboxr/repboxArt): Analyse articles in PDF or HTML versions.
  - Convert PDF or HTML to a common representation that stores text information including sections, paragraphs and footnote markers.
  - Extract and store scientific tables (relying on the `extractSciTab` package explained further below).
  - Analyse keywords, like `regression analys` and links to tables or figures in the text.

[repboxCodeText](https://github.com/repboxr/repboxCodeText): Study keywords in comments of supplement script files.
  - Currently only analyses in Stata do files of supplements whether comments contain links to tables or figures.

[repboxStata](https://github.com/repboxr/repboxStata): Analyse, modify and run Stata do files in supplements
  - Contains a rudimentary Stata parser that can write Stata do files in a more canonical form. That is required to perform code injections and systematically store information about the stata scripts.
  - Allows to prepare do files via specific code injections. Some code injections like automatic path corrections shall improve the share of do files that run out of the box. Other injections help to systematically extract log information that can be stored in a data base. While the proto-type works, there are many special cases that will need adaption of the code base. It will be a lengthy process.
  - Run the prepared Stata code in the correct order.
  - Extract the generated raw log information generated by the code injection and convert it into a format better suited for subsequent analysis.
  - The package also contains Stata code, e.g. functions in ado files that will be called to perform path correction at runtime.

[repboxR](https://github.com/repboxr/repboxR): Analyse, modify and run R files in supplements
   - While `repboxStata` has a rather monolithic structure,`repboxR` uses several other helper packages described further below. They include `sourcemodify` for code analysis and injections, `repboxRfun` for functions that will be called by injected code for path correction and more.

[repboxReg](https://github.com/repboxr/repboxReg): Analyse regressions in Stata and R scripts
  - Currently mainly implemented for Stata scripts. The prototype for R is in the repboxR package.
  - Use code injection to extract detailed information after a regression command is run, including non-rounded values for coefficients, standard errors, t- and p-values. Also general regression statistics like R2 will be stored.
  - The code injection may cause itself errors. Typically, the Stata scripts will be run twice first without and then with code injections related to the regression analysis.
  - We also extract information from a static analysis of the Stata commands and store them in a systematic fashion. One main example are systematic extraction of the type of standard errors (including clustering variables).
  - We also store information about the data set used in the regressions, e.g. which variables are numeric, categorical or dummy variables.
  - Regression formulas will be stored in a canonical table representation that contains information about variable roles (e.g. explanatory variable or instrument), features like interaction effects or variable transformations. 
  - In the results table, coefficient names are not normalized across Stata commands (or R commands). Also using the systematic information extracted from the regression formulas the `repboxReg` package transform coefficient names into a canonical form that will also allow mapping back to the information extracted from the data set. 
  - In the long run, I would like to have a framework that allows to easily run meta studies that systematically study effects of modifying existing regression analyses. E.g. one might check whether results are robust to different specifications of standard errors. My codename of that framework is `metareg`. The `repboxReg` package already contains functionality for the `metareg` project and tries to store information in a way that can be used for `metareg` studies. But the `metareg` project is still in its infancy.

[repboxMap](https://github.com/repboxr/repboxMap): Map results of the different analysis steps and sources.
  - Currently it is all about mapping the numbers shown in tables in the article with corresponding commands and output from the supplements.
  - A particular focus is on mapping results from regression tables for which `repboxReg` stores information in a systematic way.
  - Also numbers in non-regression tables can be mapped, but less well.
  - Use case 1 is to help authors and data editors that want to check whether results shown in the article's tables can indeed be reproduced by running the code in the supplement or whether there are differences.
  - Use case 2 is to store the mapped information in a database that can be used for meta studies. In the future it would be nice if LLM can extract better information from the article, e.g. the variable of interest in a regression and if could also map this information from the LLM.
  -  We currently use quite crude heuristics and there is much scope for continous improvement by studiying a lot of articles and supplements.
  -  The core structure currently distinguishes between a *matching* and a *mapping* step. The matching steps relatively mechanically maps numbers (taking into account for different roundings) between outputs of scripts and tables in the article. Typically, one part of a table has matchings with different outputs of several commands in the code. The mapping steps tries to select the best matchings for a table. Mapping heuristics can use different information. E.g. all things equal it seems more likely that all values in a table's column are generated by the same command rather than different commands, and that two different columns in a table may be generated by similar types of commands (e.g. both by regression commands). Also keyword information from the table or code comments can help mapping. For example, if the analysis in `repboxCodeText` determines based on the comments in the code, that some lines in a Stata script should correspond to Table 7 in the article, a mapping algorithm should prefer matchings from those commands. But mistakes can happen and possible the code says "Table 7" while in the final of version of the article it has been renamed to "Table 8". Thus most mapping algorithms will likely rely on a point system to transform matchings into the prefered mapping.

[repboxHtml](https://github.com/repboxr/repboxHtml): Generate reports consisting of HTML pages that describe the results of repbox analyses.
  - Currently, we create HTML pages that show the script files on the left hand side. On the right hand side are the extracted tables from the articles with color coding to describe the mapping and quickly detect possible problems.

[repboxHtml](https://github.com/repboxr/repboxHtml): Generate reports consisting of HTML pages that describe the results of repbox analyses.
  - Currently, we create HTML pages that show the script files on the left hand side. On the right hand side are the extracted tables from the articles with color coding to describe the mapping and quickly detect possible problems.

